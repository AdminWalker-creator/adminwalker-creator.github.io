<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A_W Community Chat</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <h1>A_W Community Chat</h1>

    <div id="chat-box" style="border:1px solid #fff; width:90%; height:300px; overflow-y:auto; margin:auto;"></div>

    <input id="name-input" type="text" placeholder="Your Name">
    <input id="message-input" type="text" placeholder="Your Message">
    <button id="send-btn">Send</button>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp, onSnapshot, query, orderBy } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCUw599ZSYdjmv5uJFgsxyRW16Fs9ef4Qg",
            authDomain: "aw-community-chat.firebaseapp.com",
            projectId: "aw-community-chat",
            storageBucket: "aw-community-chat.firebasestorage.app",
            messagingSenderId: "753015399762",
            appId: "1:753015399762:web:50e8094b2d0cf4a344c68b"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const chatBox = document.getElementById("chat-box");
        const nameInput = document.getElementById("name-input");
        const messageInput = document.getElementById("message-input");
        const sendBtn = document.getElementById("send-btn");

        // SEND MESSAGE
        sendBtn.onclick = async () => {
            const name = nameInput.value.trim();
            const text = messageInput.value.trim();
            if (!name || !text) return;

            await addDoc(collection(db, "messages"), {
                name,
                text,
                time: serverTimestamp()
            });

            messageInput.value = "";
        };

        // REAL TIME LISTEN
        const q = query(collection(db, "messages"), orderBy("time"));
        onSnapshot(q, (snapshot) => {
            chatBox.innerHTML = "";
            snapshot.forEach((doc) => {
                const msg = doc.data();
                const div = document.createElement("div");
                div.textContent = msg.name + ": " + msg.text;
                chatBox.appendChild(div);
            });
            chatBox.scrollTop = chatBox.scrollHeight;
        });
    </script>

</body>
</html>
